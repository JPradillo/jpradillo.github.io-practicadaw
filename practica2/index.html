
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://mydomain.org/mysite/practica2/">
      
      
        <link rel="prev" href="../practica1/">
      
      
        <link rel="next" href="../practica3/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>Práctica 2.2 - Practicas</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-22" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Practicas" class="md-header__button md-logo" aria-label="Practicas" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Practicas
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Práctica 2.2
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Practicas" class="md-nav__button md-logo" aria-label="Practicas" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Practicas
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tema2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Tema2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Teoría
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" checked>
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Prácticas
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            Prácticas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../practica1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 2.1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Práctica 2.2
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Práctica 2.2
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requisitos-antes-de-comenzar-la-practica" class="md-nav__link">
    <span class="md-ellipsis">
      Requisitos antes de comenzar la práctica
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Requisitos antes de comenzar la práctica">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduccion" class="md-nav__link">
    <span class="md-ellipsis">
      Introducción
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paquetes-necesarios" class="md-nav__link">
    <span class="md-ellipsis">
      Paquetes necesarios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creacion-de-usuarios-y-contrasenas-para-el-acceso-web" class="md-nav__link">
    <span class="md-ellipsis">
      Creación de usuarios y contraseñas para el acceso web
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configurando-el-servidor-nginx-para-usar-autenticacion-basica" class="md-nav__link">
    <span class="md-ellipsis">
      Configurando el servidor Nginx para usar autenticación básica
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tareas" class="md-nav__link">
    <span class="md-ellipsis">
      Tareas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combinacion-de-la-autenticacion-basica-con-la-restriccion-de-acceso-por-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Combinación de la autenticación básica con la restricción de acceso por IP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tareas_1" class="md-nav__link">
    <span class="md-ellipsis">
      Tareas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cuestiones-finales" class="md-nav__link">
    <span class="md-ellipsis">
      Cuestiones finales
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../practica3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 2.3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../practica4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 2.4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../practica5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 2.5
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requisitos-antes-de-comenzar-la-practica" class="md-nav__link">
    <span class="md-ellipsis">
      Requisitos antes de comenzar la práctica
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Requisitos antes de comenzar la práctica">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduccion" class="md-nav__link">
    <span class="md-ellipsis">
      Introducción
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paquetes-necesarios" class="md-nav__link">
    <span class="md-ellipsis">
      Paquetes necesarios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creacion-de-usuarios-y-contrasenas-para-el-acceso-web" class="md-nav__link">
    <span class="md-ellipsis">
      Creación de usuarios y contraseñas para el acceso web
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configurando-el-servidor-nginx-para-usar-autenticacion-basica" class="md-nav__link">
    <span class="md-ellipsis">
      Configurando el servidor Nginx para usar autenticación básica
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tareas" class="md-nav__link">
    <span class="md-ellipsis">
      Tareas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combinacion-de-la-autenticacion-basica-con-la-restriccion-de-acceso-por-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Combinación de la autenticación básica con la restricción de acceso por IP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tareas_1" class="md-nav__link">
    <span class="md-ellipsis">
      Tareas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cuestiones-finales" class="md-nav__link">
    <span class="md-ellipsis">
      Cuestiones finales
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="practica-22">Práctica 2.2</h1>
<h2 id="requisitos-antes-de-comenzar-la-practica">Requisitos antes de comenzar la práctica</h2>
<blockquote>
<p>[!WARNING] </p>
<ul>
<li>La práctica 2.1 ha de estar funcionando correctamente.</li>
<li>No empezar la práctica antes de tener la 2.1 <strong>funcionando y comprobada</strong>.</li>
</ul>
</blockquote>
<h3 id="introduccion">Introducción</h3>
<p>En el contexto de una transacción HTTP, la autenticación de acceso básica es un método diseñado para permitir a un navegador web, u otro programa cliente, proveer credenciales en la forma de usuario y contraseña cuando se le solicita una página al servidor.</p>
<p>La autenticación básica, como su nombre lo indica, es la forma más básica de autenticación disponible para las aplicaciones Web. Fue definida por primera vez en la especificación HTTP en sí y no es de ninguna manera elegante, pero cumple su función.</p>
<p>Este tipo de autenticación es el tipo más simple disponible pero adolece de importantes problemas de seguridad que no la hacen recomendable en muchas situaciones. No requiere el uso ni de cookies, ni de identificadores de sesión, ni de página de ingreso.</p>
<h3 id="paquetes-necesarios">Paquetes necesarios</h3>
<p>Para esta práctica podemos utilizar la herramienta openssl para crear las contraseñas.</p>
<p>En primer lugar debemos comprobar si el paquete está instalado:</p>
<p><code>dpkg -l | grep openssl</code></p>
<p><img alt="openssl" src="../assets/images/practica2_2/comprobacion_openssl.png" />
Y si no lo estuviera, instalarlo.</p>
<h3 id="creacion-de-usuarios-y-contrasenas-para-el-acceso-web">Creación de usuarios y contraseñas para el acceso web</h3>
<p>Crearemos un archivo oculto llamado “.htpasswd” en el directorio de configuración /etc/nginx donde guardar nuestros usuarios y contraseñas (la -c es para crear el archivo):</p>
<p><code>sudo sh -c "echo -n 'vuestro_nombre:' &gt;&gt; /etc/nginx/.htpasswd"</code></p>
<p><img alt="Archivo oculto .htpasswd" src="../assets/images/practica2_2/archivo_oculto_htpasswd.png" /></p>
<p>Ahora crearemos un password cifrado para el usuario:</p>
<p><code>sudo sh -c "openssl passwd -apr1 &gt;&gt; /etc/nginx/.htpasswd"</code></p>
<p><img alt="Passwd cifrado para el usuario" src="../assets/images/practica2_2/passwd_cifrado.png" /></p>
<p>Este proceso se podrá repetir para tantos usuarios como haga falta.</p>
<ul>
<li>Crea dos usuarios, uno con tu nombre y otro con tu primer apellido</li>
<li>Comprueba que el usuario y la contraseña aparecen cifrados en el fichero:</li>
</ul>
<p><code>cat /etc/nginx/.htpasswd</code></p>
<p><img alt="Usuarios y contraseñas cifradas" src="../assets/images/practica2_2/usuarios_contrase%C3%B1as_cifradas.png" /></p>
<h3 id="configurando-el-servidor-nginx-para-usar-autenticacion-basica">Configurando el servidor Nginx para usar autenticación básica</h3>
<p>Editaremos la configuración del server block sobre el cual queremos aplicar la restricción de acceso. Utilizaremos para esta autenticación el sitio web de Perfect Learn:</p>
<blockquote>
<p>[!NOTE]Info
Recuerda que un <em>server block</em> es cada uno de los dominios (<code>server {...}</code> dentro del archivo de configuración) de alguno de los sitios web que hay en el seridor.</p>
</blockquote>
<p><code>sudo nano /etc/nginx/sites-available/nombre_web</code></p>
<p><img alt="Comando para cambiar las restricciones" src="../assets/images/practica2_2/comando_restricciones.png" /></p>
<p><img alt="Autenticación básica" src="../assets/images/practica2_2/autenticacion_basica.png" /></p>
<p>Una vez terminada la configuración, reiniciamos el servicio para que aplique nuestra política de acceso.</p>
<p><code>sudo systemctl restart nginx</code></p>
<p><img alt="Reinicio del servicio" src="../assets/images/practica2_2/reinicio_servicio.png" /></p>
<blockquote>
<p>🟦 Comprobación 1</p>
<p>Comprueba desde tu máquina física que puedes acceder al sitio web y que se te solicita autenticación.</p>
</blockquote>
<p><img alt="Comprobación de autenticación" src="../assets/images/practica2_2/comprobacion_autenticacion.png" /></p>
<blockquote>
<p>🟦 Comprobación 2</p>
<p>Comprueba que si decides cancelar la autenticación, se te negará el acceso al sitio con un error. ¿Qué error es?</p>
</blockquote>
<p><img alt="Comprobación error" src="../assets/images/practica2_2/comprobacion_error.png" /></p>
<h3 id="tareas">Tareas</h3>
<blockquote>
<p>🟩 Tarea 1</p>
<ul>
<li>
<p>Intenta entrar primero con un usuario erróneo y luego con otro correcto. Puedes ver todos los sucesos y registros en los logs access.log y error.log</p>
</li>
<li>
<p>Adjunta una captura de pantalla de los logs donde se vea que intentas entrar primero con un usuario inválido y con otro válido. Indica dónde podemos ver los errores de usuario inválido o no encontrado, así como donde podemos ver el número de error que os aparecía antes</p>
</li>
</ul>
</blockquote>
<p><img alt="Comprobación inicio a la página" src="../assets/images/practica2_2/comprobacion_inicio_pagina.png" /></p>
<p><img alt="Accesos" src="../assets/images/practica2_2/accesos_para_entrar.png" /></p>
<p><img alt="Errores" src="../assets/images/practica2_2/error_para_entrar.png" /></p>
<p>Cuando hemos configurado el siguiente bloque:</p>
<pre><code class="language-code">location / {
        auth_basic  &quot;Àrea restringida&quot;;
        auth_basic_user_file    /etc/nginx/.htpasswd;
            try_files $uri $uri/ =404;
        }
</code></pre>
<p>La autenticación se aplica al directorio/archivo que le indicamos en la declaración del location y que en este caso el raíz /.</p>
<p>Así pues, esta restricción se aplica al directorio raíz o base donde residen los archivos del sitio web y que es en mi caso:</p>
<p><code>/var/www/practicadaw/html/simple-static-website</code></p>
<p>Y a todos los archivos que hay dentro, ya que no hemos especificado ninguno en concreto.</p>
<p>Ahora bien, vamos a probar a aplicar autenticación sólo a una parte de la web. Vamos a intentar que sólo se necesite autenticacíón para entrar a la parte de portfolio:</p>
<p>Esta sección se corresponde con el archivo <code>contact.html</code> dentro del directorio raíz.</p>
<blockquote>
<p>🟩 Tarea 2</p>
<p>Borra las dos líneas que hacen referencia a la autenticación básica en el location del direectorio raíz. Tras ello, añade un nuevo location debajo con la autenticación básica para el archivo/sección <code>contacto.html</code> unicamente.</p>
<p>[!WARNING] Warning</p>
<p>Fijaos que debéis tener cuidado porque la última línea del archivo ha de ser <code>}</code> que cierra la primera línea <code>server {</code> del archivo.</p>
</blockquote>
<p><img alt="Tarea 2" src="../assets/images/practica2_2/tarea_2.png" /></p>
<h3 id="combinacion-de-la-autenticacion-basica-con-la-restriccion-de-acceso-por-ip">Combinación de la autenticación básica con la restricción de acceso por IP</h3>
<p>La autenticación básica HTTP puede ser combinada de forma efectiva con la restricción de acceso por dirección IP. Se pueden implementar dos escenario:</p>
<ul>
<li>Un usuario debe estar ambas cosas, autenticado y tener una IP válida</li>
<li>Un usuario debe o bien estar autenticado, o bien tener una IP válida</li>
</ul>
<p>Veamos cómo lo haríamos:</p>
<ol>
<li>Como permitir o denegar acceso sobre una IP concreta (directivas allow y deny, respectivamente). Dentro del block server o archivo de configuración del dominio web, que recordad está en el directorio sites-available:</li>
</ol>
<p><img alt="Restricciones de acceso por IP" src="../assets/images/practica2_2/restriciones_IP.png" />   </p>
<pre><code>El acceso se garantizará a la IP 192.168.1.1/24, excluyendo a la dirección 192.168.1.

Hay que tener en cuenta que las directivas allow y deny se irán aplicando en el orden en el que aparecen el archivo.

Aquí aplican sobre la location /api (esto es sólo un ejemplo de un hipotético directorio o archivo), pero podrían aplicar sobre cualquiera, incluida todo el sitio web, la location raíz /.

La última directiva deny all quiere decir que por defecto denegaremos el acceso a todo el mundo. Por eso hay que poner los allow y deny más específicos justo antes de esta, porque al evaluarse en orden de aparición, si los pusiéramos debajo se denegaría el acceso a todo el mundo, puesto que deny all sería lo primero que se evaluaría.
</code></pre>
<ol>
<li>
<p>Combinar la restricción IP y la autenticación HTTP con la directiva satisfy.</p>
<p>Si establecemos el valor de la directiva a “all”, el acceso se permite si el cliente satisface ambas condiciones (IP y usario válido). Si lo establecemos a “any”, el acceso se permite si se satisface al menos una de las dos condiciones.</p>
<p><img alt="Restricciones IP y autenticación HTTP con la directiva stisfy" src="../assets/images/practica2_2/restricciones_IP_autenticacion_HTTP.png" /></p>
</li>
</ol>
<h3 id="tareas_1">Tareas</h3>
<blockquote>
<p>🟩 Tarea 1</p>
<p>Configura Nginx para que no deje acceder con la IP de la máquina anfitriona al directorio raíz de una de tus dos webs. Modifica su server block o archivo de configuración. Comprueba como se deniega el acceso:
</p>
</blockquote>
<ul>
<li>Muestra la página de error en el navegador</li>
</ul>
<p><img alt="Bloqueo de la máquina anfitriona" src="../assets/images/practica2_2/bloque_maquina_anfitriona.png" /></p>
<p><img alt="Mensaje de bloqueo" src="../assets/images/practica2_2/prueba_navegador.png" /></p>
<ul>
<li>Muestra el mensaje de error de error.log</li>
</ul>
<p><img alt="Error desde error.log" src="../assets/images/practica2_2/error_log.png" /></p>
<hr />
<blockquote>
<p>🟩 Tarea 2</p>
<p>Configura Nginx para que desde tu máquina anfitriona se tenga que tener tanto una IP válida como un usuario válido, ambas cosas a la vez, y comprueba que sí puede acceder sin problemas.</p>
<p><img alt="Configuración Nginx" src="../assets/images/practica2_2/configuracion_IP_validacion.png" /></p>
</blockquote>
<ul>
<li>Error al intentar acceder desde el móvil o con usuario incorrecto.</li>
</ul>
<p><img alt="Error al intentar entrar desde el móvil o usuario incorrectos" src="../assets/images/practica2_2/error_desde_movil.png" /></p>
<ul>
<li>Acceso con IP y usuario válidos </li>
</ul>
<p><img alt="Acceso a web con IP válida y usuario válido" src="../assets/images/practica2_2/IP_y_usuario_validos.png" /></p>
<h3 id="cuestiones-finales">Cuestiones finales</h3>
<blockquote>
<p>🟦 Cuestión 1</p>
<p>Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio <code>web_muy_guay</code> de mi sitio web, equivocándome al poner el usuario y contraseña. ¿Podré acceder?¿Por qué?</p>
<p><code>code
location /web_muy_guay {
   #...
   satisfy all;    
   deny  172.1.10.6;
   allow 172.1.10.15;
   allow 172.1.3.14;
   deny  all;
   auth_basic "Cuestión final 1";
   auth_basic_user_file conf/htpasswd;
 }</code></p>
</blockquote>
<p>No podrás acceder ya que al haber puesto <code>satisfy all</code> estás pidiendo que se cumplan ambas condiciones, tanto IP permitida como una autenticación correcta.</p>
<hr />
<blockquote>
<p>🟦 Cuestión 2</p>
<p>ask "Cuestión 1" Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio <code>web_muy_guay</code> de mi sitio web, introduciendo correctamente usuario y contraseña. ¿Podré acceder?¿Por qué?</p>
</blockquote>
<pre><code class="language-code">location /web_muy_guay {
    #...
    satisfy all;    
    deny  all;
    deny  172.1.10.6;
    allow 172.1.10.15;
    allow 172.1.3.14;
    auth_basic &quot;Cuestión final 2: The revenge&quot;;
    auth_basic_user_file conf/htpasswd;
}
</code></pre>
<p>Si introduces correctamente el usuario y la contraseña, podrás acceder al sitio porque cumples ambas condiciones: autenticación válida y tu IP está en la lista permitida.</p>
<hr />
<blockquote>
<p>🟦 Cuestión 3</p>
<p>Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio web_muy_guay de mi sitio web, introduciendo correctamente usuario y contraseña. ¿Podré acceder?¿Por qué?
</p>
</blockquote>
<pre><code class="language-code">location /web_muy_guay {
    #...
    satisfy any;    
    deny  172.1.10.6;
    deny 172.1.10.15;
    allow 172.1.3.14;

    auth_basic &quot;Cuestión final 3: The final combat&quot;;
    auth_basic_user_file conf/htpasswd;
}
</code></pre>
<p>En este caso, con <code>satisfy any</code>, aunque tu IP está bloqueada, no podrás acceder a la web porque se está aplicando una restricción de IP después que tiene prioridad.</p>
<hr />
<blockquote>
<p>🟦 Cuestión 4</p>
<p>A lo mejor no sabéis que tengo una web para documentar todas mis excursiones espaciales con Jeff, es esta: Jeff Bezos y yo</p>
<p>Supongamos que quiero restringir el acceso al directorio de proyectos porque es muy secreto, eso quiere decir añadir autenticación básica a la URL:Proyectos</p>
<p>Completa la configuración para conseguirlo:
</p>
</blockquote>
<pre><code class="language-code">server {
        listen 80;
        listen [::]:80;
        root /var/www/freewebsitetemplates.com/preview/space-science;
        index index.html index.htm index.nginx-debian.html;
        server_name freewebsitetemplates.com www.freewebsitetemplates.com;
        location              {

            try_files $uri $uri/ =404;
        }
    }
</code></pre>
<p>El código completo con los requisitos sería algo como:</p>
<pre><code class="language-code">server {
    listen 80;
    listen [::]:80;
    root /var/www/freewebsitetemplates.com/preview/space-science;
    index index.html index.htm index.nginx-debian.html;
    server_name freewebsitetemplates.com www.freewebsitetemplates.com;
    location /proyectos {
        auth_basic &quot;Proyectos secretos&quot;;
        auth_basic_user_file /etc/nginx/.htpasswd;
        try_files $uri $uri/ =404;
    }
}
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>